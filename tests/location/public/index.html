<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"> 
<head> 
<title></title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<!--link href="style.css" rel="stylesheet" type="text/css" /-->
<style>
/*	@import url('style.css'); */
#content {

}
textarea { font-size: 12px; }
</style>
</head>

<body>
<div id="content">
<label>REQUEST OJP:</label>
<form id="sendform" action="/ojp/" method="post" enctype="application/x-www-form-urlencoded">
<textarea id="xml_req" type="text" contenteditable="true" cols="90" rows="20"> 
<!--
<?xml version="1.0" encoding="UTF-8"?>
<OJP xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://www.siri.org.uk/siri" version="1.0" xmlns:ojp="http://www.vdv.de/ojp" xsi:schemaLocation="http://www.siri.org.uk/siri ../ojp-xsd-v1.0/OJP.xsd">
    <OJPRequest>
        <ServiceRequest>
            <RequestTimestamp>2021-05-06T11:57:52.438Z</RequestTimestamp>
            <RequestorRef>API-Explorer</RequestorRef>
            <ojp:OJPLocationInformationRequest>
                <RequestTimestamp>2021-05-06T11:57:52.438Z</RequestTimestamp>
                <ojp:PlaceRef>
                    <ojp:StopPlaceRef>1:1</ojp:StopPlaceRef>
                </ojp:PlaceRef>
                <ojp:Restrictions>
                    <ojp:Type>stop</ojp:Type>
                    <ojp:NumberOfResults>9</ojp:NumberOfResults>
                    <ojp:IncludePtModes>false</ojp:IncludePtModes>
                </ojp:Restrictions>
            </ojp:OJPLocationInformationRequest>
        </ServiceRequest>
    </OJPRequest>
</OJP>
-->
</textarea>
<br />
<input type="submit" name="SEND REQUEST">
<label>
    OpenTripPlanner instance: <a href="https://otp.openmove.com/otp/routers/trento">https://otp.openmove.com/otp</a>
</label>
<br /><br />
<label>RESPONSE OJP:</label>
<br />
<textarea id="xml_res" cols="90" rows="20">
</textarea>
</form>
</div>

<script src="/jquery.min.js"></script>
<script>
function formatXml(xml) {
    var formatted = '';
    var reg = /(>)(<)(\/*)/g;
    xml = xml.replace(reg, '$1\r\n$2$3');
    var pad = 0;
    jQuery.each(xml.split('\r\n'), function(index, node) {
        var indent = 0;
        if (node.match( /.+<\/\w[^>]*>$/ )) {
            indent = 0;
        } else if (node.match( /^<\/\w/ )) {
            if (pad != 0) {
                pad -= 1;
            }
        } else if (node.match( /^<\w[^>]*[^\/]>.*$/ )) {
            indent = 1;
        } else {
            indent = 0;
        }

        var padding = '';
        for (var i = 0; i < pad; i++) {
            padding += '  ';
        }

        formatted += padding + node + '\r\n';
        pad += indent;
    });

    return formatted;
}

function uncomment(text) {
    return text.replace("<!--",'').replace("-->",'');
}

var xmltext = uncomment($('#xml_req').val());

$("#xml_req").on('keyup', function() {
    xmltext = uncomment($(this).val());

    console.log(xmltext)
});

$("#sendform").submit(function(e){

//var formxml = $('#xml_req').text();
    console.log('SEND',xmltext)

	$.ajax({
		url: '/ojp/',
		type: 'POST',
		data: xmltext,
		contentType:"application/xml; charset=utf-8",
		success: function(data){
			console.log(data)

			var serializer = new XMLSerializer(); 
			var t = serializer.serializeToString(data);

			$('#xml_res').text(formatXml(t))
		}
	});

	return false;
});
</script> 

</body>
</html>
